<!DOCTYPE html>
<html>
  <head>
      <script
      src="https://code.jquery.com/jquery-3.4.1.min.js"
      integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
      crossorigin="anonymous"></script>

      <script src="video.js"></script>
    
      <style>
        body {
          margin: 10;
          padding: 0;
        }
        #wrapper {
            position: relative;
            padding: 0 0 56.25% 0;
            height: 0;
        }
        #wrapper iframe {
            position: absolute;
            top: 0;
            left: 0;
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }
        #unmute-overlay {
          position: absolute;
          top: 0;
          left: 0;
        }
        #unmute-overlay a {
          padding: 10px;
          display: block;
        }
      </style>
  </head>
  <body>
    <script>
              var player; //will hold YT player ref
    </script>
    <!-- 1. The <iframe> (and video player) will replace this <div> tag. -->
    <div id="wrapper">
     <div id="player"></div>
    </div>
    <div id="unmute-overlay">
            <a href="#" id="unmute-initial" onclick="javascript:player.unMute(); return false;">
              <img src="img/unmute-cta.png" style="width:300px; border:0px" />
            </a>
    </div>
    <script>
      // 2. This code loads the IFrame Player API code asynchronously.
      var tag = document.createElement('script');

      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      // 3. This function creates an <iframe> (and YouTube player)
      //    after the API code downloads.
      function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
          playerVars: {
              enablejsapi: 1,
              playsinline: 1, 
              autoplay: 1,
              controls: 0,
              allowfullscreen: 0,
              fs: 1,
              showinfo:1,
              modestbranding: 1
          },
          //videoId: 'M7lc1UVf-VE',
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
      }

      // 4. The API will call this function when the video player is ready.
      //    We get the latest playlist and global offset data from the server, then start playing at the correct track + time
      function onPlayerReady(event) {
        event.target.mute();
        getChannelData('TrueLifeTV', (json) => {
          event.target.loadPlaylist({list:json.playlistId,
                      listType:'playlist',
                      index:0,
                      startSeconds:parseInt(json.elapsedTime/1000),
                      suggestedQuality:'medium'})
        })
      }

      // 5. The API calls this function when the player's state changes.
      //    In order to fuck with the Apple restrictions on autoplay video with audio
      //    we mute the player before loading the playlist above, and then unmute it once
      //    playback has started. Sorry, Apple ;) 
      var initialLoadComplete = false;

      function onPlayerStateChange(event) {
        if (event.data == YT.PlayerState.PLAYING && !initialLoadComplete) {
          //player.unMute();
          initialLoadComplete = true;
        }
      }
      function stopVideo() {
        player.stopVideo();
      }


      $(() => {
        $("#unmute-initial").on("click", () => {
          player.unMute(); 
          $("#unmute-overlay").hide()
          return false
        })
      })
    </script>

</html>
