<!DOCTYPE html>
<html>
  <head>

      <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

      <script
      src="https://code.jquery.com/jquery-3.4.1.min.js"
      integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
      crossorigin="anonymous"></script>
      <style>
        body {
          margin: 10;
          padding: 0;
          font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif
        }
        #wrapper {
            position: relative;
            padding: 0 0 56.25% 0;
            height: 0;
        }
        #wrapper iframe {
            position: absolute;
            top: 0;
            left: 0;
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }
        #unmute-overlay {
          position: absolute;
          top: 0;
          left: 0;
        }
        #unmute-overlay a {
          padding: 10px;
          display: block;
        }
        .off-air b {
          color: #888888 !important;
        }
        .on-air b {
          color: #cc0000 !important;
        }
        .help-text {
          font-size: smaller;
          color: #888888; 
        }

        .broadcast-controls button{
          width: 30%;
        }


        .rc-button {

position: relative;

display: -webkit-box;

display: -ms-flexbox;

display: flex;

height: 40px;

min-height: 40px;

padding: 0 1.5rem;

cursor: pointer;
-webkit-transition: opacity 0.3s, background-color 0.3s, color 0.3s;
transition: opacity 0.3s, background-color 0.3s, color 0.3s;
text-align: center;

color: #000000;

border-width: 2px;

border-width: var(--button-border-width);
border-style: solid;
border-color: #000000;

border-radius: 2px;

border-radius: var(--button-border-radius);
background-color: transparent;

font-size: 0.875rem;

font-size: var(--button-text-size);
font-weight: 600;

-webkit-box-align: center;

    -ms-flex-align: center;

        align-items: center;
-webkit-box-pack: center;
    -ms-flex-pack: center;
        justify-content: center;
}
.rc-button:not([disabled]):hover {
  opacity: 0.6;
}
.rc-button--icon > svg {
  margin: 0 5px 0 -5px;

  font-size: 20px;
  fill: currentColor;
}
.rtl .rc-button--icon > svg {
    margin: 0 -5px 0 5px;
  }
.rc-button:active,
.rc-button:focus:hover {
  outline: none;
}
.rc-button:active {
  -webkit-transform: translateY(2px);
          transform: translateY(2px);

  opacity: 0.9;
}
.rc-button:active::before {
  top: -2px;
}
.rc-button::before {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;

  content: "";
  cursor: pointer;
}
.rc-button:disabled {
  cursor: default;

  color: #ffffff;

  color: var(--button-disabled-text-color);
  border: 0;
  border-color: #e1e5e8;
  border-color: var(--button-disabled-background);
  background-color: #e1e5e8;
  background-color: var(--button-disabled-background);
}
.rc-button--invisible {
  visibility: hidden;
}
.rc-button--primary {
  color: #ffffff;
  color: var(--button-primary-text-color);
  border: 0;
  background-color: #1d74f5;
  background-color: var(--button-primary-background);
}
.rc-button--nude {
  border: none;
  background-color: inherit;

  font-weight: 400;
}
.rc-button--primary.rc-button--nude {
  color: #1d74f5;
  color: var(--button-primary-background);
}
.rc-button--primary.rc-button--outline {
  color: #1d74f5;
  color: var(--button-primary-background);
  border-color: #1d74f5;
  border-color: var(--button-primary-background);
}
.rc-button--secondary {
  color: #414852;
  color: var(--button-secondary-text-color);
  border: 0;
  border-color: #cbced1;
  border-color: var(--button-secondary-background);
  background-color: #cbced1;
  background-color: var(--button-secondary-background);
}
.rc-button--secondary.rc-button--outline {
  color: #cbced1;
  color: var(--button-secondary-background);
  border-color: #cbced1;
  border-color: var(--button-secondary-background);
}
.rc-button--cancel {
  color: #ffffff;
  color: var(--button-primary-text-color);
  border: 0;
  border-color: #f5455c;
  border-color: var(--button-cancel-color);
  background-color: #f5455c;
  background-color: var(--button-cancel-color);
}
.rc-button--cancel.rc-button--outline {
  color: #f5455c;
  color: var(--button-cancel-color);
  border-color: #f5455c;
  border-color: var(--button-cancel-color);
}
.rc-button--small {
  height: 28px;
  height: var(--button-height-small);
  min-height: 28px;
  min-height: var(--button-height-small);
  padding: 0 0.5rem;
  padding: var(--button-padding-small);

  font-size: 13px;

  font-size: var(--button-text-size-small);
}
.rc-button--square {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-flex: 0;
      -ms-flex: 0 0 36px;
          flex: 0 0 36px;
  -ms-flex: 0 0 var(--button-square-size);
      flex: 0 0 var(--button-square-size);

  margin: 0;
  padding: 0;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.rc-button--outline {
  border-width: 2px;
  border-style: solid;
  background: transparent;
}
.rc-button--stack {
  width: 100%;
}
.rc-button--no-padding {
  padding-right: 0;
  padding-left: 0;
}

      </style>
  </head>
  <body>
  
    <script src="video.js"></script>
    <script>
        //select channel with querystring ...admin.html?channel=
        selectedChannel = getUrlVars()["channel"] || "TrueLifeTV"
    </script>
    <!-- 1. The <iframe> (and video player) will replace this <div> tag. -->

    <div class="channel-status">
        <h3 class="embed">Broadcast Studio - #<ch>MyLostHamsterTV</ch><br />
          <span class="off-air">OFF AIR</span>
          <span class="on-air">ON AIR</span> 
        </h3>
  
        <div class="help-text off-air">
          Choose any <a target="_blank" href="https://youtube.com">YouTube</a> playlist and stream it 
          to your audience, here on SocVid.tv or by adding the SocVid player to your website. 
        </div>

        <div class="help-text on-air">
            #<ch>MyLostHamsterTV</ch> is now streaming. <a class="content-source-link">View or edit playlist</a>
        </div>  


          <h3>Content To Broadcast</h3>
          <input id="newPlaylistId" type="text" placeholder="Link to a YouTube Playlist" /> 
          <button class="rc-button rc-button--primary"id="updatePlaylist">Stream Now</button>
          <div class="help-text">
            Loads a playlist and starts streaming its contents from the beginning.  
          </div>

          <div class="broadcast-controls" style="width:100%">
            <h3>Control My Broadcast</h3>

            <button class="rc-button rc-button--secondary" id="restartBroadcast">Restart</button>
            <button class="rc-button rc-button--secondary" id="resyncBroadcast">Resync *</button>
            <button class="rc-button rc-button--primary" id="stopBroadcast">Stop</button>

            <div class="help-text">
              * Resync: updates your SocVid playlist if it has been modified on YouTube YouTube, then 
                restart streaming from the beginning.
            </div>

          </div>
    </div>

    <div class="no-embed debug">
      <pre id="channelJson"></pre>
    </div>

    <script>
      const setOnAir=() => {
        $(".on-air").show()
        $(".off-air").hide()
      }
      const setOffAir=() => {
        $(".on-air").hide()
        $(".off-air").show()
      }
      const isOnAir = () => {
        return (typeof channelJson.playlist !== 'undefined' && channelJson.playlist.length > 0)
      }
      const updateBroadcastStatus = () => {
        if (isOnAir()) {
          setOnAir()
        } else {
          setOffAir()
        }

        $("input, button").removeAttr("disabled")
      }
      const disableAfterSubmit=() => {
        $("input, button").attr("disabled", "disabled")
      }
      
      $(() => {
        if (getUrlVars()["layout"]=="embedded") {
          $(".embed").show()
          $(".no-embed").hide()
        } else {
          $(".embed").hide()
          $(".no-embed").show()
        }
        
        getChannelData(selectedChannel, (json) => {
          window.channelJson = json
          $("#channelJson").html(JSON.stringify(json, null, 2))
        })

        $("#updatePlaylist").on("click", () => {
            disableAfterSubmit();

            let listId = getUrlVars($("#newPlaylistId").val())["list"]
            if (typeof listId === 'undefined' || listId.length == 0) {
                console.log("Invalid Playlist Url: "+$("#newPlaylistId").val())
                updateBroadcastStatus()
                return
            }
            listId = listId.replace('#', '') //kill any trailing hashes
            setNewPlaylistForChannel(listId, selectedChannel, 
            (json) => {
                window.channelJson = json
                $("#channelJson").html(JSON.stringify(json, null, 2))
                updateBroadcastStatus()
            });
        })


        $("#restartBroadcast").on("click", () => {
            disableAfterSubmit();

            restartPlaylist(selectedChannel, (json) => {
                window.channelJson = json
                $("#channelJson").html(JSON.stringify(json, null, 2))
                updateBroadcastStatus()
            })
        })

        $("ch").html(selectedChannel)
        $("#channelLink").attr("href", $("#channelLink").attr("href")+selectedChannel)
        $("#channelLink").html(selectedChannel)
      })
    </script>

</html>
